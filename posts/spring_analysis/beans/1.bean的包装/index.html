<!doctype html>
<html lang="en-us">
  <head>
    <title>1.Beançš„åŒ…è£… // gngpp</title>
    <link rel="shortcut icon" href="/favicon.ico" />
    <meta charset="utf-8" />
    <meta name="generator" content="Hugo 0.99.1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="gngpp" />
    <meta name="description" content="" />
    <link rel="stylesheet" href="https://blog.innas.cn/css/main.min.4a7ec8660f9a44b08c4da97c5f2e31b1192df1d4d0322e65c0dbbc6ecb1b863f.css" />

    
    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="1.Beançš„åŒ…è£…"/>
<meta name="twitter:description" content="1.å‰è¨€ ä¸ºä»€ä¹ˆå…ˆä»å¯¹beançš„åŒ…è£…å¼€å§‹é˜…è¯»æºç å‘¢ï¼Œå› ä¸ºbeansåŒ…çš„æ ¸å¿ƒå°±æ˜¯BeanFactory ğŸ¶ï¼Œå…¶ä½œç”¨å°±æ˜¯å¯¹beanè¿›è¡Œç®¡ç†ï¼Œé‚£ä¹ˆå¯¹beanç®¡ç†çš„å‰æå°±æ˜¯å¯¹beanè¿›è¡Œè§£æï¼Œç„¶åæ”¯æŒå±æ€§çš„set æˆ– get æ“ä½œã€‚é‚£ä¹ˆæˆ‘ä»¬åˆ—ä¸¾ä¸€ä¸‹BeanFactoryçš„ä¸»è¦èŒè´£ï¼Œå³ä½¿æ²¡é˜…è¯»è¿‡æºç ï¼Œä¹Ÿåº”è¯¥çŸ¥é“ä¸ªå¤§æ¦‚è¿‡ç¨‹.
 è§£æxmlæˆ–è€…å…¶å®ƒé…ç½®æ–‡ä»¶å¾—åˆ° BeanDefinition å®ä¾‹åŒ– Instance AutoWiredè‡ªåŠ¨è£…é… Beançš„ä¾èµ–  æ‰€ä»¥ï¼Œæˆ‘ä»¬å…ˆäº†è§£å¦‚ä½•å»å¾—åˆ°ä¸€ä¸ªBeançš„ â€œå®šä¹‰â€ (è§£æxmlé‚£éƒ¨åˆ†å…ˆä¸è®²)
2. BeanWrapperæ¥å£ è¿™ä¸ªç±»çš„ä¸»è¦ä½œç”¨æ˜¯è§£æ`Class` ç„¶åè·å–å±æ€§ï¼Œè¿›ä¸€æ­¥å°è£…ï¼Œç„¶åæä¾›ä¿®æ”¹å±æ€§çš„æ¥å£ public interface BeanWrapper extends ConfigurablePropertyAccessor {  // è®¾ç½®é›†åˆå±æ€§è‡ªå¢é•¿çš„é•¿åº¦ 	void setAutoGrowCollectionLimit(int autoGrowCollectionLimit); 	 // è·å–å½“å‰é›†åˆå±æ€§è‡ªå¢é•¿çš„é•¿åº¦ 	int getAutoGrowCollectionLimit(); 		// è·å–åŒ…è£…çš„Beançš„Instance 	Object getWrappedInstance(); 		// è·å–Beançš„Class 	Class&lt;?&gt; getWrappedClass(); 		// è·å–æ‰€æœ‰å±æ€§æè¿°ç¬¦ 	PropertyDescriptor[] getPropertyDescriptors();   // è·å–å±æ€§æè¿°ç¬¦ 	PropertyDescriptor getPropertyDescriptor(String propertyName) throws InvalidPropertyException;  } ä¸ºä»€ä¹ˆä¸Šé¢ä¼šæ¶‰åŠåˆ°é›†åˆï¼Œå› ä¸ºBean æ”¯æŒnested (åµŒå¥—) å±æ€§è¯»å†™ï¼Œä¹Ÿå°±æ˜¯pojo"/>

    <meta property="og:title" content="1.Beançš„åŒ…è£…" />
<meta property="og:description" content="1.å‰è¨€ ä¸ºä»€ä¹ˆå…ˆä»å¯¹beançš„åŒ…è£…å¼€å§‹é˜…è¯»æºç å‘¢ï¼Œå› ä¸ºbeansåŒ…çš„æ ¸å¿ƒå°±æ˜¯BeanFactory ğŸ¶ï¼Œå…¶ä½œç”¨å°±æ˜¯å¯¹beanè¿›è¡Œç®¡ç†ï¼Œé‚£ä¹ˆå¯¹beanç®¡ç†çš„å‰æå°±æ˜¯å¯¹beanè¿›è¡Œè§£æï¼Œç„¶åæ”¯æŒå±æ€§çš„set æˆ– get æ“ä½œã€‚é‚£ä¹ˆæˆ‘ä»¬åˆ—ä¸¾ä¸€ä¸‹BeanFactoryçš„ä¸»è¦èŒè´£ï¼Œå³ä½¿æ²¡é˜…è¯»è¿‡æºç ï¼Œä¹Ÿåº”è¯¥çŸ¥é“ä¸ªå¤§æ¦‚è¿‡ç¨‹.
 è§£æxmlæˆ–è€…å…¶å®ƒé…ç½®æ–‡ä»¶å¾—åˆ° BeanDefinition å®ä¾‹åŒ– Instance AutoWiredè‡ªåŠ¨è£…é… Beançš„ä¾èµ–  æ‰€ä»¥ï¼Œæˆ‘ä»¬å…ˆäº†è§£å¦‚ä½•å»å¾—åˆ°ä¸€ä¸ªBeançš„ â€œå®šä¹‰â€ (è§£æxmlé‚£éƒ¨åˆ†å…ˆä¸è®²)
2. BeanWrapperæ¥å£ è¿™ä¸ªç±»çš„ä¸»è¦ä½œç”¨æ˜¯è§£æ`Class` ç„¶åè·å–å±æ€§ï¼Œè¿›ä¸€æ­¥å°è£…ï¼Œç„¶åæä¾›ä¿®æ”¹å±æ€§çš„æ¥å£ public interface BeanWrapper extends ConfigurablePropertyAccessor {  // è®¾ç½®é›†åˆå±æ€§è‡ªå¢é•¿çš„é•¿åº¦ 	void setAutoGrowCollectionLimit(int autoGrowCollectionLimit); 	 // è·å–å½“å‰é›†åˆå±æ€§è‡ªå¢é•¿çš„é•¿åº¦ 	int getAutoGrowCollectionLimit(); 		// è·å–åŒ…è£…çš„Beançš„Instance 	Object getWrappedInstance(); 		// è·å–Beançš„Class 	Class&lt;?&gt; getWrappedClass(); 		// è·å–æ‰€æœ‰å±æ€§æè¿°ç¬¦ 	PropertyDescriptor[] getPropertyDescriptors();   // è·å–å±æ€§æè¿°ç¬¦ 	PropertyDescriptor getPropertyDescriptor(String propertyName) throws InvalidPropertyException;  } ä¸ºä»€ä¹ˆä¸Šé¢ä¼šæ¶‰åŠåˆ°é›†åˆï¼Œå› ä¸ºBean æ”¯æŒnested (åµŒå¥—) å±æ€§è¯»å†™ï¼Œä¹Ÿå°±æ˜¯pojo" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://blog.innas.cn/posts/spring_analysis/beans/1.bean%E7%9A%84%E5%8C%85%E8%A3%85/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-08-02T11:39:34+00:00" />
<meta property="article:modified_time" content="2021-08-02T11:39:34+00:00" />



  </head>
  <body>
    <header class="app-header">
      <a href="https://blog.innas.cn/"><img class="app-header-avatar" src="/avatar.png" alt="gngpp" /></a>
      <h1>gngpp</h1>
      <nav class="app-header-menu">
          <a class="app-header-menu-item" href="/">Home</a>
             - 
          
          <a class="app-header-menu-item" href="/tags/">Tags</a>
             - 
          
          <a class="app-header-menu-item" href="/categories/">Categories</a>
             - 
          
          <a class="app-header-menu-item" href="/about/">About</a>
      </nav>
      <p>å…´è¶£ä½¿ç„¶</p>
      <div class="app-header-social">
        
          <a href="https://github.com/gngpp" target="_blank" rel="noreferrer noopener">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github">
  <title>Github</title>
  <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
</svg>
          </a>
        
      </div>
    </header>
    <main class="app-container">
      
  <article class="post">
    <header class="post-header">
      <h1 class ="post-title">1.Beançš„åŒ…è£…</h1>
      <div class="post-meta">
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <title>calendar</title>
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg>
          Aug 2, 2021
        </div>
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <title>clock</title>
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg>
          4 min read
        </div>
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag">
  <title>tag</title>
  <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line>
</svg>
              <a class="tag" href="https://blog.innas.cn/tags/spring-bean/">Spring-Bean</a>
        </div>
      </div>
    </header>
    <div class="post-content">
      <h3 id="1å‰è¨€">1.å‰è¨€</h3>
<p>ä¸ºä»€ä¹ˆå…ˆä»å¯¹beançš„åŒ…è£…å¼€å§‹é˜…è¯»æºç å‘¢ï¼Œå› ä¸ºbeansåŒ…çš„æ ¸å¿ƒå°±æ˜¯<code>BeanFactory</code> ğŸ¶ï¼Œå…¶ä½œç”¨å°±æ˜¯å¯¹beanè¿›è¡Œç®¡ç†ï¼Œé‚£ä¹ˆå¯¹beanç®¡ç†çš„å‰æå°±æ˜¯å¯¹beanè¿›è¡Œè§£æï¼Œç„¶åæ”¯æŒå±æ€§çš„<code>set</code> æˆ– <code>get</code> æ“ä½œã€‚é‚£ä¹ˆæˆ‘ä»¬åˆ—ä¸¾ä¸€ä¸‹<code>BeanFactory</code>çš„ä¸»è¦èŒè´£ï¼Œå³ä½¿æ²¡é˜…è¯»è¿‡æºç ï¼Œä¹Ÿåº”è¯¥çŸ¥é“ä¸ªå¤§æ¦‚è¿‡ç¨‹.</p>
<ul>
<li>è§£æ<code>xml</code>æˆ–è€…å…¶å®ƒé…ç½®æ–‡ä»¶å¾—åˆ° <code>BeanDefinition</code></li>
<li>å®ä¾‹åŒ– <code>Instance</code></li>
<li><code>AutoWired</code>è‡ªåŠ¨è£…é… <code>Bean</code>çš„ä¾èµ–</li>
</ul>
<p><strong>æ‰€ä»¥ï¼Œæˆ‘ä»¬å…ˆäº†è§£å¦‚ä½•å»å¾—åˆ°ä¸€ä¸ªBeançš„ â€œå®šä¹‰â€ (è§£æxmlé‚£éƒ¨åˆ†å…ˆä¸è®²)</strong></p>
<h3 id="2-beanwrapperæ¥å£">2. BeanWrapperæ¥å£</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tex" data-lang="tex"><span style="display:flex;"><span>è¿™ä¸ªç±»çš„ä¸»è¦ä½œç”¨æ˜¯è§£æ`Class` ç„¶åè·å–å±æ€§ï¼Œè¿›ä¸€æ­¥å°è£…ï¼Œç„¶åæä¾›ä¿®æ”¹å±æ€§çš„æ¥å£
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">BeanWrapper</span> <span style="color:#66d9ef">extends</span> ConfigurablePropertyAccessor <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// è®¾ç½®é›†åˆå±æ€§è‡ªå¢é•¿çš„é•¿åº¦
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setAutoGrowCollectionLimit</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> autoGrowCollectionLimit<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// è·å–å½“å‰é›†åˆå±æ€§è‡ªå¢é•¿çš„é•¿åº¦
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">getAutoGrowCollectionLimit</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// è·å–åŒ…è£…çš„Beançš„Instance
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	Object <span style="color:#a6e22e">getWrappedInstance</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// è·å–Beançš„Class
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	Class<span style="color:#f92672">&lt;?&gt;</span> getWrappedClass<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// è·å–æ‰€æœ‰å±æ€§æè¿°ç¬¦
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	PropertyDescriptor<span style="color:#f92672">[]</span> <span style="color:#a6e22e">getPropertyDescriptors</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// è·å–å±æ€§æè¿°ç¬¦
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	PropertyDescriptor <span style="color:#a6e22e">getPropertyDescriptor</span><span style="color:#f92672">(</span>String propertyName<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> InvalidPropertyException<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>ä¸ºä»€ä¹ˆä¸Šé¢ä¼šæ¶‰åŠåˆ°<strong>é›†åˆ</strong>ï¼Œå› ä¸º<code>Bean</code> æ”¯æŒ<code>nested (åµŒå¥—)</code> å±æ€§è¯»å†™ï¼Œä¹Ÿå°±æ˜¯<code>pojo</code></p>
<pre tabindex="0"><code class="language-properties" data-lang="properties">bean.setValue(&#34;bean.child.attr&#34;, 1)
</code></pre><h3 id="3-beanwrapperimplå®ç°">3. <code>BeanWrapperImplå®ç°</code></h3>
<ol>
<li>
<p>æˆ‘ä»¬ä»å…¶æµ‹è¯•ä»£ç ä¸­å¯ä»¥çœ‹åˆ°è¿™æ ·çš„ç”¨æ³•</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>GetterBean target <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> GetterBean<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>BeanWrapper accessor <span style="color:#f92672">=</span> createAccessor<span style="color:#f92672">(</span>target<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>accessor<span style="color:#f92672">.</span><span style="color:#a6e22e">setPropertyValue</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;name&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;tom&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>assertThat<span style="color:#f92672">(</span>target<span style="color:#f92672">.</span><span style="color:#a6e22e">getAliasedName</span><span style="color:#f92672">()).</span><span style="color:#a6e22e">isEqualTo</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;tom&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>assertThat<span style="color:#f92672">(</span>accessor<span style="color:#f92672">.</span><span style="color:#a6e22e">getPropertyValue</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;aliasedName&#34;</span><span style="color:#f92672">)).</span><span style="color:#a6e22e">isEqualTo</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;tom&#34;</span><span style="color:#f92672">);</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">protected</span> BeanWrapperImpl <span style="color:#a6e22e">createAccessor</span><span style="color:#f92672">(</span>Object target<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> BeanWrapperImpl<span style="color:#f92672">(</span>target<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">}</span>
</span></span></code></pre></div><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ° <code>createAccessor</code> å°±æ˜¯<code>new BeanWrapperImpl</code>å°±å®Œæˆå¯¹<code>Bean</code>çš„å°è£…äº†ï¼Œ å°±å¯ä»¥è°ƒç”¨</p>
<ul>
<li><code>setPropertyValue</code>  è®¾ç½®å±æ€§å€¼</li>
<li><code>getPropertyValue</code>  è·å–å±æ€§å€¼</li>
</ul>
</li>
<li>
<p>åˆæ­¥çœ‹ä¸‹ <code>BeanWrapperImpl</code>çš„<code>UML</code> (ä¸ç”¨çº ç»“ <code>UML</code> åé¢ä¼šäººè‚‰å…¶è¿è¡Œè¿‡ç¨‹) :happy:</p>
</li>
</ol>
<p><img src="/img/1.bean%E7%9A%84%E5%8C%85%E8%A3%85/image-20191012223223606.png" alt=""></p>
<p><strong>åœ¨ä¸Šé¢è¿™ä¸ªå›¾ä¸­ï¼Œç€é‡ <code>AbstractNesablePropertyAccessor</code></strong> æ­¤ç±»æ˜¯ç”¨äºæ”¯æŒä¸Šæ–‡æåˆ°çš„<code>Nested</code> åµŒå¥—å±æ€§è¯»å†™.</p>
<ol start="3">
<li>
<p><code>getPropertyDescriptor</code> è·å–å±æ€§æè¿°ç¬¦</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> PropertyDescriptor <span style="color:#a6e22e">getPropertyDescriptor</span><span style="color:#f92672">(</span>String propertyName<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> InvalidPropertyException <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">// [1] å…ˆè§£æåµŒå¥—å±æ€§ï¼Œè·å–æœ€åä¸€ä¸ªå±æ€§çš„Instance
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		BeanWrapperImpl nestedBw <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>BeanWrapperImpl<span style="color:#f92672">)</span> getPropertyAccessorForPropertyPath<span style="color:#f92672">(</span>propertyName<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>		String finalPath <span style="color:#f92672">=</span> getFinalPath<span style="color:#f92672">(</span>nestedBw<span style="color:#f92672">,</span> propertyName<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">// [2] ç„¶åç›´æ¥è·å–å±æ€§æè¿°ç¬¦
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		PropertyDescriptor pd <span style="color:#f92672">=</span> nestedBw<span style="color:#f92672">.</span><span style="color:#a6e22e">getCachedIntrospectionResults</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getPropertyDescriptor</span><span style="color:#f92672">(</span>finalPath<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>pd <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> InvalidPropertyException<span style="color:#f92672">(</span>getRootClass<span style="color:#f92672">(),</span> getNestedPath<span style="color:#f92672">()</span> <span style="color:#f92672">+</span> propertyName<span style="color:#f92672">,</span>
</span></span><span style="display:flex;"><span>					<span style="color:#e6db74">&#34;No property &#39;&#34;</span> <span style="color:#f92672">+</span> propertyName <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;&#39; found&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> pd<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">}</span>
</span></span></code></pre></div><ul>
<li>
<p>åˆšæ‰æˆ‘ä»¬è¯´è¿‡å…¶æ”¯æŒ<code>nested</code> åµŒå¥—å±æ€§ï¼Œå¦‚æœæˆ‘ä»¬ä¼ å…¥çš„<code>propertyName</code> ä¸º <code>bean.child.name</code> ï¼Œæˆ‘ä»¬å°±è¦å…ˆæ‹¿åˆ° <code>bean</code> ç„¶åå†æ‹¿åˆ° <code>child</code> æœ€åæ‹¿åˆ° <code>name</code> ç„¶åæ‰èƒ½è¿”å›ç±»å‹æè¿°ç¬¦. â€‹ :warning: ç¬¬ä¸€æ­¥æˆ‘ä»¬å…ˆä¸ç®¡</p>
</li>
<li>
<p>ç„¶åç¬¬äºŒæ­¥ <code>getCachedIntrospectionResults#getPropertyDescriptor()</code> æ¥è·å–å±æ€§æè¿°ç¬¦</p>
</li>
<li>
<p><code>CachedIntrospectionResults</code> ä¸­åŒ…å« <code>PropertyDescriptor</code> ä¿¡æ¯ï¼Œè·Ÿä¸‹å»</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">private</span> CachedIntrospectionResults <span style="color:#a6e22e">getCachedIntrospectionResults</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>   	<span style="color:#75715e">// [1] åˆ¤æ–­æ˜¯ä¸æ˜¯æœ‰ç¼“å­˜äº†
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">cachedIntrospectionResults</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// [2] ç¼“å­˜ä¸­æ²¡æœ‰é‚£å°± new
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>			<span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">cachedIntrospectionResults</span> <span style="color:#f92672">=</span> CachedIntrospectionResults<span style="color:#f92672">.</span><span style="color:#a6e22e">forClass</span><span style="color:#f92672">(</span>getWrappedClass<span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">cachedIntrospectionResults</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">}</span>
</span></span></code></pre></div><p>ç»§ç»­è·Ÿã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">static</span> CachedIntrospectionResults <span style="color:#a6e22e">forClass</span><span style="color:#f92672">(</span>Class<span style="color:#f92672">&lt;?&gt;</span> beanClass<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> BeansException <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">// [1] ä»ä¸€çº§ç¼“å­˜ä¸­è·å–
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		CachedIntrospectionResults results <span style="color:#f92672">=</span> strongClassCache<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>beanClass<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>results <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">return</span> results<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">// [2] ä»äºŒçº§ç¼“å­˜ä¸­è·å–
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		results <span style="color:#f92672">=</span> softClassCache<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>beanClass<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>results <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">return</span> results<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">// [3] å¦‚æœéƒ½æ²¡æœ‰ï¼Œåˆ™Newä¸€ä¸ª, æ ¸å¿ƒè¿˜æ˜¯åœ¨è¿™
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		results <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> CachedIntrospectionResults<span style="color:#f92672">(</span>beanClass<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>		ConcurrentMap<span style="color:#f92672">&lt;</span>Class<span style="color:#f92672">&lt;?&gt;,</span> CachedIntrospectionResults<span style="color:#f92672">&gt;</span> classCacheToUse<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">// [4] åˆ¤æ–­ä½¿ç”¨ä¸€çº§ç¼“å­˜è¿˜æ˜¯äºŒçº§ç¼“å­˜
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#75715e">// ç»è°ƒè¯•ï¼Œå‘ç°springç”¨çš„æ˜¯ä¸€çº§ç¼“å­˜
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>ClassUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">isCacheSafe</span><span style="color:#f92672">(</span>beanClass<span style="color:#f92672">,</span> CachedIntrospectionResults<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getClassLoader</span><span style="color:#f92672">())</span> <span style="color:#f92672">||</span>
</span></span><span style="display:flex;"><span>				isClassLoaderAccepted<span style="color:#f92672">(</span>beanClass<span style="color:#f92672">.</span><span style="color:#a6e22e">getClassLoader</span><span style="color:#f92672">()))</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>			classCacheToUse <span style="color:#f92672">=</span> strongClassCache<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>logger<span style="color:#f92672">.</span><span style="color:#a6e22e">isDebugEnabled</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>				logger<span style="color:#f92672">.</span><span style="color:#a6e22e">debug</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Not strongly caching class [&#34;</span> <span style="color:#f92672">+</span> beanClass<span style="color:#f92672">.</span><span style="color:#a6e22e">getName</span><span style="color:#f92672">()</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;] because it is not cache-safe&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>			classCacheToUse <span style="color:#f92672">=</span> softClassCache<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">// [5] å°†æ–°Newçš„æ”¾å…¥ç¼“å­˜
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		CachedIntrospectionResults existing <span style="color:#f92672">=</span> classCacheToUse<span style="color:#f92672">.</span><span style="color:#a6e22e">putIfAbsent</span><span style="color:#f92672">(</span>beanClass<span style="color:#f92672">,</span> results<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> <span style="color:#f92672">(</span>existing <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">?</span> existing <span style="color:#f92672">:</span> results<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">}</span>
</span></span></code></pre></div><p>å¯ä»¥çœ‹åˆ°<code>spring</code> å¾ˆå–„ç”¨ç¼“å­˜ï¼Œè¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼Œå…¶ç”¨äº†ä¸¤ä¸ªç¼“å­˜ <code>strongClassCache</code> å’Œ <code>softClassCache</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>  <span style="color:#75715e">/* [DESC] ä¸€çº§ç¼“å­˜*/</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> ConcurrentMap<span style="color:#f92672">&lt;</span>Class<span style="color:#f92672">&lt;?&gt;,</span> CachedIntrospectionResults<span style="color:#f92672">&gt;</span> strongClassCache <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">new</span> ConcurrentHashMap<span style="color:#f92672">&lt;&gt;(</span>64<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">/* [DESC] äºŒçº§ç¼“å­˜ åˆç§°ä¸º SoftCacheï¼Œå› ä¸ºé‡‡ç”¨å¼±å¼•ç”¨MAPï¼Œæ‰€ä»¥ç¼“å­˜å…ƒç´ é•¿æ—¶é—´æœªä½¿ç”¨åˆ™ä¼šè¢«å›æ”¶*/</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> ConcurrentMap<span style="color:#f92672">&lt;</span>Class<span style="color:#f92672">&lt;?&gt;,</span> CachedIntrospectionResults<span style="color:#f92672">&gt;</span> softClassCache <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">new</span> ConcurrentReferenceHashMap<span style="color:#f92672">&lt;&gt;(</span>64<span style="color:#f92672">);</span>
</span></span></code></pre></div><p><strong>è™½ç„¶å…¶è®¾ç½®äº†ä¸¤å±‚ç¼“å­˜ï¼Œä½†å®é™…åªç”¨åˆ°äº† <code>strongClassCache</code></strong> å› ä¸ºå±æ€§è¿™äº›ä¼šå¸¸é©»å†…å­˜ï¼Œæ‰€ä»¥ä¸éœ€è¦ä½¿ç”¨å¼±å¼•ç”¨çš„<code>Map</code>,å®é™…ä¸Šæ§åˆ¶ä½¿ç”¨é‚£ä¸ªç¼“å­˜æ˜¯<code>isCacheSafe</code> æ¥æ§åˆ¶çš„, ç»§ç»­è·Ÿ :hammer:æˆ‘æ˜¯æœ€å¼ºäººè‚‰ç‹å­</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">isCacheSafe</span><span style="color:#f92672">(</span>Class<span style="color:#f92672">&lt;?&gt;</span> clazz<span style="color:#f92672">,</span> <span style="color:#a6e22e">@Nullable</span> ClassLoader classLoader<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>   Assert<span style="color:#f92672">.</span><span style="color:#a6e22e">notNull</span><span style="color:#f92672">(</span>clazz<span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;Class must not be null&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// [1] è·å–è¯¥ç±»çš„ClassLoader
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      ClassLoader target <span style="color:#f92672">=</span> clazz<span style="color:#f92672">.</span><span style="color:#a6e22e">getClassLoader</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// Common cases
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// [2] å¦‚æœç›®æ ‡ç±»çš„ClassLoader == æä¾›çš„classLoader
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#75715e">// [NOTICE] åŒäº²å§”æ´¾åŸåˆ™ï¼Œåªæœ‰ä½¿ç”¨åŒä¸€ä¸ªç±»åŠ è½½å™¨ï¼ŒåŠ è½½çš„æ•°æ®æ‰èƒ½æ˜¯åªæœ‰ä¸€ä»½ï¼Œè¿™ä¸ªç¼“å­˜æ‰æ˜¯æ˜¯æœ‰æ•ˆçš„
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>target <span style="color:#f92672">==</span> classLoader <span style="color:#f92672">||</span> target <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>         <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>classLoader <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>         <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// [3] é€’å½’classLoaderçš„ç¥–å…ˆ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#75715e">// Check for match in ancestors -&gt; positive
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      ClassLoader current <span style="color:#f92672">=</span> classLoader<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">while</span> <span style="color:#f92672">(</span>current <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>         current <span style="color:#f92672">=</span> current<span style="color:#f92672">.</span><span style="color:#a6e22e">getParent</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>         <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>current <span style="color:#f92672">==</span> target<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>         <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// [4] é€’å½’ç›®æ ‡çš„ç¥–å…ˆ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#75715e">// Check for match in children -&gt; negative
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">while</span> <span style="color:#f92672">(</span>target <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>         target <span style="color:#f92672">=</span> target<span style="color:#f92672">.</span><span style="color:#a6e22e">getParent</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>         <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>target <span style="color:#f92672">==</span> classLoader<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>         <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>SecurityException ex<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// Fall through to loadable check below
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>   <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   <span style="color:#75715e">// Fallback for ClassLoaders without parent/child relationship:
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>   <span style="color:#75715e">// safe if same Class can be loaded from given ClassLoader
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>   <span style="color:#66d9ef">return</span> <span style="color:#f92672">(</span>classLoader <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">&amp;&amp;</span> isLoadable<span style="color:#f92672">(</span>clazz<span style="color:#f92672">,</span> classLoader<span style="color:#f92672">));</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p><strong>è¿™é‡Œåˆ¤æ–­cacheæ˜¯å¦å®‰å…¨çš„åŸç†æ˜¯</strong> ï¼Œæ ¹æ®<code>åŒäº²å§”æ´¾</code> æœºåˆ¶ï¼Œå› ä¸ºä¸€ä¸ªç±»è¢«ä¸€ä¸ªåŠ è½½å™¨åŠ è½½ä¸€æ¬¡åœ¨å†…å­˜ä¸­å°±ä¼šæœ‰ä¸€ä»½<code>Class</code> , å¦‚æœå®ƒä»¬çš„åŠ è½½å™¨æ˜¯ä¸€æ ·çš„ï¼Œé‚£ä¹ˆå¾—åˆ°çš„<code>Class</code> ä¹Ÿæ˜¯ä¸€è‡´çš„ï¼Œè¿™æ ·æ‰èƒ½ç¡®ä¿ï¼Œæˆ‘ä»¬æ‹¿åˆ°çš„ç›®æ ‡<code>Class</code> æ•°æ®æ˜¯æ­£ç¡®çš„ã€‚</p>
<p>è§£æå®Œè¿™ä¸ªï¼Œæˆ‘ä»¬ç»§ç»­ä¸Šé¢çš„ï¼Œå¦‚æœä»ç¼“å­˜æ‹¿ä¸åˆ°åˆ™ <code>new</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>results <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> CachedIntrospectionResults<span style="color:#f92672">(</span>beanClass<span style="color:#f92672">);</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">private</span> <span style="color:#a6e22e">CachedIntrospectionResults</span><span style="color:#f92672">(</span>Class<span style="color:#f92672">&lt;?&gt;</span> beanClass<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> BeansException <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>logger<span style="color:#f92672">.</span><span style="color:#a6e22e">isTraceEnabled</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>				logger<span style="color:#f92672">.</span><span style="color:#a6e22e">trace</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Getting BeanInfo for class [&#34;</span> <span style="color:#f92672">+</span> beanClass<span style="color:#f92672">.</span><span style="color:#a6e22e">getName</span><span style="color:#f92672">()</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;]&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>			<span style="color:#75715e">// å…³æ³¨ #getBeanInfo
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>			<span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">beanInfo</span> <span style="color:#f92672">=</span> getBeanInfo<span style="color:#f92672">(</span>beanClass<span style="color:#f92672">);</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> BeanInfo <span style="color:#a6e22e">getBeanInfo</span><span style="color:#f92672">(</span>Class<span style="color:#f92672">&lt;?&gt;</span> beanClass<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> IntrospectionException <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>   <span style="color:#75715e">// [1] å°è¯•ä»åŠ è½½çš„å·¥å‚ä¸­è·å–BeanInfo
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>   <span style="color:#75715e">// å®é™…ä¸Šï¼Œspring.beans åªæä¾›ä¸€ä¸ªå·¥å‚ï¼Œè€Œä¸”é‚£ä¸ªå·¥å‚ä¹Ÿæ˜¯ä»çº¿ç¨‹ä¸Šä¸‹æ–‡ä¸­è·å–
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>   <span style="color:#75715e">// æ‰€ä»¥ä¸€å®šèƒ½æ‹¿åˆ°ï¼Œè¿™æ˜¯ä¸ºäº†é˜²æ­¢spring.beansæ²¡æœ‰æä¾›å·¥å‚è€Œè€ƒè™‘åˆ°çš„ç»†èŠ‚
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>   <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>BeanInfoFactory beanInfoFactory <span style="color:#f92672">:</span> beanInfoFactories<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>      BeanInfo beanInfo <span style="color:#f92672">=</span> beanInfoFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">getBeanInfo</span><span style="color:#f92672">(</span>beanClass<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>beanInfo <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>         <span style="color:#66d9ef">return</span> beanInfo<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   <span style="color:#75715e">// [2] å¦‚æœä¸æä¾›å·¥å‚æˆ–è€…å·¥å‚ä¸å­˜åœ¨ï¼Œç›´æ¥åœ¨çº¿ç¨‹ä¸Šä¸‹æ–‡ä¸­è·å–
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>   <span style="color:#66d9ef">return</span> <span style="color:#f92672">(</span>shouldIntrospectorIgnoreBeaninfoClasses <span style="color:#f92672">?</span>
</span></span><span style="display:flex;"><span>         Introspector<span style="color:#f92672">.</span><span style="color:#a6e22e">getBeanInfo</span><span style="color:#f92672">(</span>beanClass<span style="color:#f92672">,</span> Introspector<span style="color:#f92672">.</span><span style="color:#a6e22e">IGNORE_ALL_BEANINFO</span><span style="color:#f92672">)</span> <span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>         Introspector<span style="color:#f92672">.</span><span style="color:#a6e22e">getBeanInfo</span><span style="color:#f92672">(</span>beanClass<span style="color:#f92672">));</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>åœ¨<code>CachedIntrospectionResults</code> ä¸­ï¼Œå®ƒä¼šåŠ è½½ä¸€ä¸ª <code>factory</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">/** [DESC]  åœ¨è¿™é‡ŒåŠ è½½BeanInfoFactory*/</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// åŠ è½½ &#34;META-INF/spring.factories&#34; ä¸­æŒ‡å®šçš„å·¥å‚ç±»
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> List<span style="color:#f92672">&lt;</span>BeanInfoFactory<span style="color:#f92672">&gt;</span> beanInfoFactories <span style="color:#f92672">=</span> SpringFactoriesLoader<span style="color:#f92672">.</span><span style="color:#a6e22e">loadFactories</span><span style="color:#f92672">(</span>
</span></span><span style="display:flex;"><span>      BeanInfoFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">,</span> CachedIntrospectionResults<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getClassLoader</span><span style="color:#f92672">());</span>
</span></span></code></pre></div><pre tabindex="0"><code class="language-properties" data-lang="properties">org.springframework.beans.BeanInfoFactory=org.springframework.beans.ExtendedBeanInfoFactory
</code></pre><p>å‘ç°äº†ï¼Œå®ƒçš„é»˜è®¤å·¥å‚ç±»æ˜¯ <code>ExtendedBeanInfoFactory</code></p>
<p>æ¥ä¸‹æ¥ç»§ç»­çœ‹ï¼Œå¦‚æœå·¥å‚ç±»ä¸­ä¸å­˜åœ¨ <code>BeanInfo</code>åˆ™ä¼šè°ƒç”¨ <code>Introspector#getBeanInfo()</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> BeanInfo <span style="color:#a6e22e">getBeanInfo</span><span style="color:#f92672">(</span>Class<span style="color:#f92672">&lt;?&gt;</span> beanClass<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">throws</span> IntrospectionException
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(!</span>ReflectUtil<span style="color:#f92672">.</span><span style="color:#a6e22e">isPackageAccessible</span><span style="color:#f92672">(</span>beanClass<span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> Introspector<span style="color:#f92672">(</span>beanClass<span style="color:#f92672">,</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">,</span> USE_ALL_BEANINFO<span style="color:#f92672">)).</span><span style="color:#a6e22e">getBeanInfo</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>  			<span style="color:#75715e">// ä»çº¿ç¨‹ä¸Šä¸‹æ–‡è·å–å·²ç»åŠ è½½çš„ Class ä¿¡æ¯
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        ThreadGroupContext context <span style="color:#f92672">=</span> ThreadGroupContext<span style="color:#f92672">.</span><span style="color:#a6e22e">getContext</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        BeanInfo beanInfo<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">synchronized</span> <span style="color:#f92672">(</span>declaredMethodCache<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            beanInfo <span style="color:#f92672">=</span> context<span style="color:#f92672">.</span><span style="color:#a6e22e">getBeanInfo</span><span style="color:#f92672">(</span>beanClass<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>beanInfo <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            beanInfo <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Introspector<span style="color:#f92672">(</span>beanClass<span style="color:#f92672">,</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">,</span> USE_ALL_BEANINFO<span style="color:#f92672">).</span><span style="color:#a6e22e">getBeanInfo</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">synchronized</span> <span style="color:#f92672">(</span>declaredMethodCache<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                context<span style="color:#f92672">.</span><span style="color:#a6e22e">putBeanInfo</span><span style="color:#f92672">(</span>beanClass<span style="color:#f92672">,</span> beanInfo<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> beanInfo<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span></code></pre></div><p>åˆ°æ­¤å°±ä¸ç”¨è¿½äº†ï¼Œè¿™é‡Œå·²ç»æ˜¯jdkäº†ï¼Œå®é™…ä¸Šæ˜¯ä» <code>çº¿ç¨‹ä¸Šä¸‹æ–‡</code>è·å–çš„ <code>BeanInfo</code> ï¼Œè¿™ä¹Ÿè¯æ˜äº† <code>BeanFactory</code> ç”¨çš„æ˜¯ <code>çº¿ç¨‹ä¸Šä¸‹æ–‡åŠ è½½å™¨</code></p>
<p><strong>å…¶å®ä¸Šé¢çš„ é»˜è®¤å·¥å‚ ExtendedBeanInfoFactory</strong> ç”¨çš„ä¹Ÿæ˜¯<code>ä¸Šä¸‹æ–‡åŠ è½½å™¨</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ExtendedBeanInfoFactory</span> <span style="color:#66d9ef">implements</span> BeanInfoFactory<span style="color:#f92672">,</span> Ordered <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    * Return an {@link ExtendedBeanInfo} for the given bean class, if applicable.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    */</span>
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">@Nullable</span>
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">public</span> BeanInfo <span style="color:#a6e22e">getBeanInfo</span><span style="color:#f92672">(</span>Class<span style="color:#f92672">&lt;?&gt;</span> beanClass<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> IntrospectionException <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> <span style="color:#f92672">(</span>supports<span style="color:#f92672">(</span>beanClass<span style="color:#f92672">)</span> <span style="color:#f92672">?</span> <span style="color:#66d9ef">new</span> ExtendedBeanInfo<span style="color:#f92672">(</span>Introspector<span style="color:#f92672">.</span><span style="color:#a6e22e">getBeanInfo</span><span style="color:#f92672">(</span>beanClass<span style="color:#f92672">))</span> <span style="color:#f92672">:</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">}</span>
</span></span></code></pre></div><p><strong>æ€»ç»“ä¸‹ï¼Œä»¥å…è·Ÿå¾—å¤ªæ·±ï¼Œå›æº¯ä¸äº†</strong></p>
</li>
</ul>
<p><img src="/img/1.bean%E7%9A%84%E5%8C%85%E8%A3%85/image-20191013012133042.png" alt=""></p>
<p>ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬ä¹Ÿåªæ˜¯æ‹¿åˆ°äº† <code>BeanInfo</code>
å›åˆ° <code>new CachedIntrospectionResults</code> çš„åœ°æ–¹ï¼Œæˆ‘ä»¬é¦–å…ˆå·²ç»æœ‰äº† <code>BeanInfo</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">private</span> <span style="color:#a6e22e">CachedIntrospectionResults</span><span style="color:#f92672">(</span>Class<span style="color:#f92672">&lt;?&gt;</span> beanClass<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> BeansException <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// å…³æ³¨ #getBeanInfo
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">beanInfo</span> <span style="color:#f92672">=</span> getBeanInfo<span style="color:#f92672">(</span>beanClass<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">propertyDescriptorCache</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> LinkedHashMap<span style="color:#f92672">&lt;&gt;();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// [1] ç›´æ¥è·å–BeanInfoçš„ {@link PropertyDescriptor}
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      PropertyDescriptor<span style="color:#f92672">[]</span> pds <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">beanInfo</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getPropertyDescriptors</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>PropertyDescriptor pd <span style="color:#f92672">:</span> pds<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>         <span style="color:#75715e">// [2] æŸäº›å±æ€§æ˜¯è¢«ä¿æŠ¤çš„ï¼Œåˆ™è·³è¿‡
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>         <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>Class<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span> <span style="color:#f92672">==</span> beanClass <span style="color:#f92672">&amp;&amp;</span>
</span></span><span style="display:flex;"><span>               <span style="color:#f92672">(</span><span style="color:#e6db74">&#34;classLoader&#34;</span><span style="color:#f92672">.</span><span style="color:#a6e22e">equals</span><span style="color:#f92672">(</span>pd<span style="color:#f92672">.</span><span style="color:#a6e22e">getName</span><span style="color:#f92672">())</span> <span style="color:#f92672">||</span>  <span style="color:#e6db74">&#34;protectionDomain&#34;</span><span style="color:#f92672">.</span><span style="color:#a6e22e">equals</span><span style="color:#f92672">(</span>pd<span style="color:#f92672">.</span><span style="color:#a6e22e">getName</span><span style="color:#f92672">())))</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">continue</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>         <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>         <span style="color:#75715e">// [3] å°†{@link PropertyDescriptor} è½¬æ¢ä¸º {@link GenericTypeAwarePropertyDescriptor}
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>         pd <span style="color:#f92672">=</span> buildGenericTypeAwarePropertyDescriptor<span style="color:#f92672">(</span>beanClass<span style="color:#f92672">,</span> pd<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>         <span style="color:#75715e">// [4] ä¸¢å…¥ç¼“å­˜
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>         <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">propertyDescriptorCache</span><span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span>pd<span style="color:#f92672">.</span><span style="color:#a6e22e">getName</span><span style="color:#f92672">(),</span> pd<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// [5] è¿˜å¾—åˆ¤æ–­è¿™äº›æ–¹æ³•æ˜¯ä¸æ˜¯java8çš„æ¥å£çš„é»˜è®¤æ–¹æ³•
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      Class<span style="color:#f92672">&lt;?&gt;</span> currClass <span style="color:#f92672">=</span> beanClass<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">while</span> <span style="color:#f92672">(</span>currClass <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">&amp;&amp;</span> currClass <span style="color:#f92672">!=</span> Object<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>         introspectInterfaces<span style="color:#f92672">(</span>beanClass<span style="color:#f92672">,</span> currClass<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>         currClass <span style="color:#f92672">=</span> currClass<span style="color:#f92672">.</span><span style="color:#a6e22e">getSuperclass</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">typeDescriptorCache</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ConcurrentReferenceHashMap<span style="color:#f92672">&lt;&gt;();</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>ç›´æ¥ä» <code>BeanInfo</code> æ‹¿åˆ°å±æ€§æè¿°ç¬¦ï¼Œå¹¶ä¸”ç¼“å­˜èµ·æ¥ï¼Œç°åœ¨æˆ‘ä»¬å°±å®Œæˆäº†è·å– <code>BeanInfo</code> éƒ¨åˆ†äº†ï¼Œé‚£ä¹ˆå‰©ä¸‹çš„å°±æ˜¯æ ¹æ®æ‹¿åˆ°çš„ <code>PropertyDescriptor</code> å»è¯»å†™ <code>Property</code> :wink:</p>
</li>
</ol>

    </div>
    <div class="post-footer">
      
    </div>
  </article>

    </main>
  </body>
</html>
